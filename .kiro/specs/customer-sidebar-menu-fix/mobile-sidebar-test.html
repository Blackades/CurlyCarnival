<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Sidebar Navigation Test</title>
    <link rel="stylesheet" href="../../../ui/ui/styles/bootstrap.min.css">
    <link rel="stylesheet" href="../../../ui/ui/fonts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../ui/ui/styles/modern-AdminLTE.min.css">
    <link rel="stylesheet" href="../../../ui/ui/styles/phpnuxbill.customer.css">
    <style>
        /* Test viewport indicator */
        .viewport-indicator {
            position: fixed;
            top: 0;
            right: 0;
            background: #f00;
            color: #fff;
            padding: 5px 10px;
            z-index: 9999;
            font-size: 12px;
        }
        
        /* Simulate mobile viewport */
        @media (max-width: 767px) {
            .viewport-indicator {
                background: #0f0;
            }
        }
        
        /* Test results panel */
        .test-results {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            border-top: 2px solid #333;
            padding: 10px;
            z-index: 9998;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .test-item {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid #ccc;
            padding-left: 10px;
        }
        
        .test-item.pass {
            border-left-color: #0f0;
            background: #e8f5e9;
        }
        
        .test-item.fail {
            border-left-color: #f00;
            background: #ffebee;
        }
    </style>
</head>
<body class="hold-transition modern-skin-dark sidebar-mini">
    <div class="viewport-indicator">Desktop View</div>
    
    <div class="wrapper">
        <header class="main-header" style="position:fixed; width: 100%">
            <a href="#" class="logo">
                <span class="logo-mini"><b>N</b>uX</span>
                <span class="logo-lg">Test Company</span>
            </a>
            <nav class="navbar navbar-static-top">
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>
            </nav>
        </header>

        <aside class="main-sidebar" style="position:fixed;">
            <section class="sidebar">
                <ul class="sidebar-menu" data-widget="tree">
                    <li class="active">
                        <a href="#dashboard" class="nav-link">
                            <i class="fa fa-dashboard"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#inbox" class="nav-link">
                            <i class="fa fa-envelope"></i>
                            <span>Inbox</span>
                        </a>
                    </li>
                    <li>
                        <a href="#voucher" class="nav-link">
                            <i class="fa fa-ticket"></i>
                            <span>Voucher</span>
                        </a>
                    </li>
                    <li>
                        <a href="#balance" class="nav-link">
                            <i class="fa fa-shopping-cart"></i>
                            <span>Buy Balance</span>
                        </a>
                    </li>
                    <li>
                        <a href="#package" class="nav-link">
                            <i class="fa fa-shopping-cart"></i>
                            <span>Buy Package</span>
                        </a>
                    </li>
                    <li>
                        <a href="#history" class="nav-link">
                            <i class="fa fa-file-text"></i>
                            <span>Payment History</span>
                        </a>
                    </li>
                </ul>
            </section>
        </aside>

        <div class="content-wrapper">
            <section class="content-header">
                <h1>Mobile Sidebar Navigation Test</h1>
            </section>
            <section class="content">
                <div class="box box-primary">
                    <div class="box-header">
                        <h3 class="box-title">Test Instructions</h3>
                    </div>
                    <div class="box-body">
                        <h4>Manual Testing Steps:</h4>
                        <ol>
                            <li><strong>Resize browser to mobile width (≤767px)</strong> - Viewport indicator should turn green</li>
                            <li><strong>Click hamburger button</strong> - Sidebar should open with overlay</li>
                            <li><strong>Click close button (X)</strong> - Sidebar should close</li>
                            <li><strong>Open sidebar again</strong></li>
                            <li><strong>Click a navigation link</strong> - Sidebar should close automatically after 150ms</li>
                            <li><strong>Open sidebar again</strong></li>
                            <li><strong>Click outside sidebar (on overlay)</strong> - Sidebar should close</li>
                            <li><strong>Rotate device/change orientation</strong> - Test in both portrait and landscape</li>
                            <li><strong>Resize to desktop (>767px)</strong> - Sidebar should close if open</li>
                        </ol>
                        
                        <h4>Expected Behaviors:</h4>
                        <ul>
                            <li>✓ Sidebar closes after clicking navigation links on mobile</li>
                            <li>✓ Sidebar closes when clicking overlay</li>
                            <li>✓ Close button (X) is visible and functional</li>
                            <li>✓ Sidebar doesn't remain open after page navigation</li>
                            <li>✓ Sidebar closes when resizing to desktop</li>
                            <li>✓ Touch targets are at least 44x44px</li>
                        </ul>
                        
                        <h4>Automated Test Results:</h4>
                        <div id="test-results-container"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="test-results">
        <strong>Test Log:</strong>
        <div id="test-log"></div>
    </div>

    <script src="../../../ui/ui/scripts/jquery-2.1.3.min.js"></script>
    <script src="../../../ui/ui/scripts/bootstrap.min.js"></script>
    <script src="../../../ui/ui/scripts/adminlte.min.js"></script>
    <script>
        var appUrl = '';
    </script>
    <script src="../../../ui/ui/scripts/custom.js"></script>
    
    <script>
        // Test automation script
        (function() {
            var testLog = [];
            
            function logTest(message, passed) {
                var logEntry = {
                    message: message,
                    passed: passed,
                    timestamp: new Date().toLocaleTimeString()
                };
                testLog.push(logEntry);
                updateTestLog();
            }
            
            function updateTestLog() {
                var logHtml = testLog.map(function(entry) {
                    var className = entry.passed ? 'pass' : 'fail';
                    var icon = entry.passed ? '✓' : '✗';
                    return '<div class="test-item ' + className + '">' +
                           '<strong>' + icon + '</strong> ' +
                           entry.timestamp + ' - ' + entry.message +
                           '</div>';
                }).join('');
                $('#test-log').html(logHtml);
            }
            
            function isMobile() {
                return window.innerWidth <= 767;
            }
            
            function updateViewportIndicator() {
                var indicator = $('.viewport-indicator');
                if (isMobile()) {
                    indicator.text('Mobile View (' + window.innerWidth + 'px)');
                } else {
                    indicator.text('Desktop View (' + window.innerWidth + 'px)');
                }
            }
            
            // Run tests after page load
            $(document).ready(function() {
                updateViewportIndicator();
                
                // Test 1: Check if close button exists on mobile
                setTimeout(function() {
                    if (isMobile()) {
                        var hasCloseBtn = $('.sidebar-close-btn').length > 0;
                        logTest('Close button exists on mobile', hasCloseBtn);
                    }
                }, 500);
                
                // Test 2: Check if sidebar is closed on load
                var sidebarClosedOnLoad = !$('body').hasClass('sidebar-open');
                logTest('Sidebar closed on page load', sidebarClosedOnLoad);
                
                // Test 3: Monitor sidebar toggle
                $('.sidebar-toggle').on('click', function() {
                    setTimeout(function() {
                        var isOpen = $('body').hasClass('sidebar-open');
                        logTest('Sidebar toggle clicked - Sidebar is ' + (isOpen ? 'open' : 'closed'), true);
                    }, 100);
                });
                
                // Test 4: Monitor navigation link clicks
                $('.sidebar-menu .nav-link').on('click', function(e) {
                    e.preventDefault();
                    var linkText = $(this).find('span').text();
                    logTest('Navigation link clicked: ' + linkText, true);
                    
                    if (isMobile()) {
                        setTimeout(function() {
                            var isClosed = !$('body').hasClass('sidebar-open');
                            logTest('Sidebar auto-closed after link click', isClosed);
                        }, 200);
                    }
                });
                
                // Test 5: Monitor close button clicks
                $(document).on('click', '.sidebar-close-btn', function() {
                    logTest('Close button clicked', true);
                    setTimeout(function() {
                        var isClosed = !$('body').hasClass('sidebar-open');
                        logTest('Sidebar closed after close button click', isClosed);
                    }, 100);
                });
                
                // Test 6: Monitor window resize
                $(window).on('resize', function() {
                    updateViewportIndicator();
                    logTest('Window resized to ' + window.innerWidth + 'px', true);
                });
            });
        })();
    </script>
</body>
</html>
